"use strict";(self.webpackChunkModernize=self.webpackChunkModernize||[]).push([[711],{3711:(Q,g,n)=>{n.r(g),n.d(g,{LoginComponent:()=>B});var t=n(3953),a=n(9417),u=n(4710),b=n(6806),m=n(5463),F=n(7797),S=n(7355),E=n(3730),I=n(537),M=n(4666),v=n(177);function x(i,l){if(1&i&&(t.j41(0,"div",6),t.EFF(1),t.k0s()),2&i){const o=t.XpG();t.R7$(),t.SpI(" ",o.errorMessage," ")}}let k=(()=>{class i{constructor(){this.number1=0,this.number2=0,this.operator="+",this.resultControl=new a.MJ(null),this.errorMessage="",this.verified=new t.bkB}ngOnInit(){this.generateCaptcha(),this.resultControl.valueChanges.subscribe(o=>{this.checkAnswer(o)})}generateCaptcha(){this.number1=Math.floor(10*Math.random()),this.number2=Math.floor(10*Math.random());const o=["+","*"];this.operator=o[Math.floor(Math.random()*o.length)],this.resultControl.setValue(""),this.errorMessage=""}getExpectedResult(){switch(this.operator){case"+":return this.number1+this.number2;case"-":return this.number1-this.number2;case"*":return this.number1*this.number2;default:return 0}}checkAnswer(o){const r=parseInt(o,10);isNaN(r)||r!==this.getExpectedResult()?this.verified.emit(!1):(this.errorMessage="",this.verified.emit(!0))}static#t=this.\u0275fac=function(r){return new(r||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-simple-captcha"]],outputs:{verified:"verified"},standalone:!0,features:[t.aNF],decls:8,vars:5,consts:[[1,"captcha-container"],[1,"captcha-label"],[1,"captcha-row"],["type","number","placeholder","Tu respuesta",1,"captcha-input",3,"formControl"],["type","button",1,"captcha-refresh",3,"click"],["class","captcha-error",4,"ngIf"],[1,"captcha-error"]],template:function(r,e){1&r&&(t.j41(0,"div",0)(1,"label",1),t.EFF(2),t.k0s(),t.j41(3,"div",2),t.nrm(4,"input",3),t.j41(5,"button",4),t.bIt("click",function(){return e.generateCaptcha()}),t.EFF(6," \u21bb "),t.k0s()(),t.DNE(7,x,2,1,"div",5),t.k0s()),2&r&&(t.R7$(2),t.E5c(" \xbfCu\xe1nto es ",e.number1," ",e.operator," ",e.number2,"? "),t.R7$(2),t.Y8G("formControl",e.resultControl),t.R7$(3),t.Y8G("ngIf",e.errorMessage))},dependencies:[a.X1,a.me,a.Q0,a.BC,a.l_,v.MD,v.bT],styles:[".captcha-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin-top:12px}.captcha-label[_ngcontent-%COMP%]{font-weight:600;font-size:14px}.captcha-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.captcha-input[_ngcontent-%COMP%]{padding:6px 10px;font-size:14px;width:120px;border:1px solid #ccc;border-radius:4px}.captcha-button[_ngcontent-%COMP%], .captcha-refresh[_ngcontent-%COMP%]{font-size:13px;padding:6px 10px;cursor:pointer;border:none;border-radius:4px;background-color:#3f51b5;color:#fff;transition:background-color .3s ease}.captcha-refresh[_ngcontent-%COMP%]{background-color:#757575}.captcha-button[_ngcontent-%COMP%]:hover{background-color:#303f9f}.captcha-refresh[_ngcontent-%COMP%]:hover{background-color:#616161}.captcha-error[_ngcontent-%COMP%]{color:red;font-size:13px}"],changeDetection:0})}return i})();var f=n(2122),j=n(856),R=n(8006),y=n(4970),O=n(6118),N=n(4006),h=n(2102),w=n(9631),C=n(8834),$=n(9213);function D(i,l){1&i&&(t.j41(0,"div",24),t.EFF(1,"El DNI debe tener 8 digitos"),t.k0s())}function L(i,l){1&i&&(t.j41(0,"div",24),t.EFF(1," El DNI no debe tener m\xe1s 8 digitos "),t.k0s())}function P(i,l){1&i&&(t.j41(0,"div",24),t.EFF(1," Dni es "),t.j41(2,"strong"),t.EFF(3,"requerido"),t.k0s()())}function T(i,l){if(1&i&&(t.j41(0,"mat-hint",16),t.DNE(1,D,2,0,"div",24)(2,L,2,0,"div",24)(3,P,4,0,"div",24),t.k0s()),2&i){const o=t.XpG();t.R7$(),t.vxM(o.loginForm.controls.dni.hasError("minlength")?1:-1),t.R7$(),t.vxM(o.loginForm.controls.dni.hasError("maxlength")?2:-1),t.R7$(),t.vxM(o.loginForm.controls.dni.hasError("required")?3:-1)}}function A(i,l){1&i&&(t.j41(0,"div",24),t.EFF(1," Contrase\xf1a debe tener al menos 8 d\xedgitos "),t.k0s())}function X(i,l){1&i&&(t.j41(0,"div",24),t.EFF(1," Contrase\xf1a es "),t.j41(2,"strong"),t.EFF(3,"requerida"),t.k0s()())}function G(i,l){if(1&i&&(t.j41(0,"mat-hint",16),t.DNE(1,A,2,0,"div",24)(2,X,4,0,"div",24),t.k0s()),2&i){const o=t.XpG();t.R7$(),t.vxM(o.loginForm.controls.password.hasError("minlength")&&!o.loginForm.controls.password.hasError("required")?1:-1),t.R7$(),t.vxM(o.loginForm.controls.password.hasError("required")?2:-1)}}let B=(()=>{class i{constructor(o,r){this.settings=o,this.dialog=r,this.hide=!0,this.options=this.settings.getOptions(),this.captchaValid=!1,this.loginForm=new a.gE({dni:new a.MJ("",[a.k0.required,a.k0.minLength(8),a.k0.maxLength(8)]),password:new a.MJ("",[a.k0.required,a.k0.minLength(8)])}),this.authService=(0,t.WQX)(S.u),this.usuarioService=(0,t.WQX)(M.D),this.appservice=(0,t.WQX)(R.R),this.entidadservice=(0,t.WQX)(y.t),this.router=(0,t.WQX)(u.Ix),this.notifications=(0,t.WQX)(b.I2),this.personaService=(0,t.WQX)(I.D),this.menuService=(0,t.WQX)(E.$),this.menu1="",this.firstOptionMenu=(0,t.vPA)("")}submit(){this.router.navigate(["/dashboards/dashboard1"])}login(){const o=this.loginForm.controls.dni.value;this.authService.login(o,this.loginForm.controls.password.value).subscribe(e=>{e&&e.success?(console.log("authService.login",e),localStorage.setItem("token",e.data.token),this.authService.nombresApellidos.set(e.data.persona.nombres+" "+e.data.persona.apellidoPat+" "+e.data.persona.apellidoMat),this.authService.userEmail.set(e.data.persona.email),this.authService.userName.set(o),this.authService.userRole.set(e.data.roles[0].name),this.authService.userIdRol.set(e.data.roles[0].id),this.appservice.GetByAplicationPerRol(this.authService.userIdRol()).subscribe(s=>{this.authService.aplicacion.set(s.descripcion),this.authService.idAplicacion.set(s.id.toString()),localStorage.setItem("Aplicacion",this.authService.aplicacion()),localStorage.setItem("idAplicacion",this.authService.idAplicacion()),this.menuService.GetByAplicationAsync(parseInt(this.authService.idAplicacion())).subscribe({next:d=>{d.forEach(c=>{c.idMenuPadre||(m.Cn.push({id:c.id,displayName:c.descripcion,iconName:c.icono,route:c.ruta,children:[]}),this.firstOptionMenu.set(m.Cn[0].route))}),this.router.navigate([this.firstOptionMenu()]),m.Cn.forEach(c=>{c.children=d.filter(p=>p.idMenuPadre===c.id)}),this.notifications.set(f.vi,!0)},error:d=>{console.error("Error al obtener men\xfa:",d),this.notifications.info(...j.I.info("El usuario no tiene permisos asignados."))}})}),this.authService.roles.update(s=>[]),this.authService.roles.update(s=>[...s,...e.data.roles]),this.entidadservice.GetByEntidadPerRol(this.authService.userIdRol()).subscribe(s=>{this.authService.entidad.set(s.descripcion),localStorage.setItem("entidad",this.authService.entidad())}),this.authService.unidadOrganicas.set(e.data.unidadOrganicas[0].descripcion),localStorage.setItem("userRole",this.authService.userRole()),localStorage.setItem("userIdRol",this.authService.userIdRol()),localStorage.setItem("roles",JSON.stringify(this.authService.roles())),localStorage.setItem("unidadOrganica",this.authService.unidadOrganicas()),localStorage.setItem("userEmail",this.authService.userEmail()),localStorage.setItem("nombreApellido",this.authService.nombresApellidos()),localStorage.setItem("userName",this.authService.userName()),this.authService.loggedIn.set(!0),this.authService.idEntidad.set(e.data.entidad.id.toString()),localStorage.setItem("idEntidad",this.authService.idEntidad()),localStorage.setItem("idUsuario",e.data.idUsuario)):this.notifications.set(f.oA,!0)})}onCaptchaVerified(o){this.captchaValid=o}static#t=this.\u0275fac=function(r){return new(r||i)(t.rXU(O.P),t.rXU(N.bZ))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-login"]],standalone:!0,features:[t.aNF],decls:33,vars:9,consts:[[1,"blank-layout-container","justify-content-center"],[1,"position-relative","row","w-100","h-100"],[1,"col-lg-7","col-xl-8","bg-gredient","p-0",2,"background-image","url('./assets/images/backgrounds/Foto_6.svg')"],[1,"p-24","h-100"],["src","./assets/images/logos/logo_goreu_text_ligth.png","alt","login",2,"max-width","20%"],[1,"col-lg-5","col-xl-4","p-0"],[1,"p-32","d-flex","align-items-start","align-items-lg-center","justify-content-center","h-100"],[1,"row","justify-content-center","w-100"],[1,"col-lg-9","max-width-form"],[1,"text-center"],["src","./assets/images/logos/logo_goreu_ligth.png","alt","login",2,"max-width","60%"],[1,"or-border","m-t-30"],[1,"m-t-30",3,"formGroup"],[1,"f-s-14","f-w-600","m-b-12","d-block"],["appearance","outline","color","primary",1,"w-100"],["matInput","","formControlName","dni","placeholder","Ingrese aqui su DNI"],[1,"m-b-16","error-msg"],["matInput","","placeholder","Ingrese aqui su Contrase\xf1a",3,"type","formControl"],["mat-icon-button","","matSuffix","",3,"click"],[1,"op-5"],[3,"verified"],[1,"d-flex","align-items-center","m-b-12"],["routerLink","/forgot-password",1,"text-primary","f-w-600","text-decoration-none","m-l-auto","f-s-14"],["mat-flat-button","","color","primary",1,"w-100",3,"click","disabled"],[1,"text-error"]],template:function(r,e){1&r&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),t.nrm(4,"img",4),t.k0s()(),t.j41(5,"div",5)(6,"div",6)(7,"div",7)(8,"div",8)(9,"div",9),t.nrm(10,"img",10),t.k0s(),t.j41(11,"div",11),t.EFF(12,"Inicio de Sesi\xf3n"),t.k0s(),t.j41(13,"form",12)(14,"mat-label",13),t.EFF(15,"DNI"),t.k0s(),t.j41(16,"mat-form-field",14),t.nrm(17,"input",15),t.DNE(18,T,4,3,"mat-hint",16),t.k0s(),t.j41(19,"mat-label",13),t.EFF(20,"Contrase\xf1a"),t.k0s(),t.j41(21,"mat-form-field",14),t.nrm(22,"input",17),t.j41(23,"button",18),t.bIt("click",function(){return e.hide=!e.hide}),t.j41(24,"mat-icon",19),t.EFF(25),t.k0s()(),t.DNE(26,G,3,2,"mat-hint",16),t.k0s(),t.j41(27,"app-simple-captcha",20),t.bIt("verified",function(d){return e.onCaptchaVerified(d)}),t.k0s(),t.j41(28,"div",21)(29,"a",22),t.EFF(30,"\xbfOlvidaste tu contrase\xf1a ?"),t.k0s()(),t.j41(31,"button",23),t.bIt("click",function(){return e.login()}),t.EFF(32," Iniciar Sesi\xf3n "),t.k0s()()()()()()()()),2&r&&(t.R7$(13),t.Y8G("formGroup",e.loginForm),t.R7$(5),t.vxM(e.loginForm.controls.dni.touched&&e.loginForm.controls.dni.invalid?18:-1),t.R7$(4),t.Y8G("type",e.hide?"password":"text")("formControl",e.loginForm.controls.password),t.R7$(),t.BMQ("aria-label","Hide password")("aria-pressed",e.hide),t.R7$(2),t.JRh(e.hide?"visibility_off":"visibility"),t.R7$(),t.vxM(e.loginForm.controls.password.touched&&e.loginForm.controls.password.invalid?26:-1),t.R7$(5),t.Y8G("disabled",!e.loginForm.valid||!e.captchaValid))},dependencies:[u.iI,u.Wk,F.G,h.rl,h.nJ,h.MV,h.yw,w.fg,C.$z,C.iY,$.An,a.YN,a.qT,a.me,a.BC,a.cb,a.X1,a.l_,a.j4,a.JD,k],encapsulation:2,changeDetection:0})}return i})()}}]);